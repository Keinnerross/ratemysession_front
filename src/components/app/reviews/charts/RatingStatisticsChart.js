"use client";

import React, { useEffect, useState } from "react";

export default function RatingStatisticsChart({
  rating = 0,
  distribution = { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 }
}) {
  const [animatedHeights, setAnimatedHeights] = useState({ 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 });
  const [hoveredStar, setHoveredStar] = useState(null);
  const [mousePos, setMousePos] = useState({ x: 0, y: 0 });

  // Calculate the maximum height for normalization
  const maxCount = Math.max(...Object.values(distribution), 1);

  // Calculate total reviews for percentage calculation
  const totalReviews = Object.values(distribution).reduce((sum, count) => sum + count, 0);

  // Calculate percentages for each star rating
  const percentages = {
    5: totalReviews > 0 ? Math.round((distribution[5] / totalReviews) * 100) : 0,
    4: totalReviews > 0 ? Math.round((distribution[4] / totalReviews) * 100) : 0,
    3: totalReviews > 0 ? Math.round((distribution[3] / totalReviews) * 100) : 0,
    2: totalReviews > 0 ? Math.round((distribution[2] / totalReviews) * 100) : 0,
    1: totalReviews > 0 ? Math.round((distribution[1] / totalReviews) * 100) : 0,
  };

  // Calculate target bar heights (max height is 236px based on SVG)
  const targetHeights = {
    5: Math.round((distribution[5] / maxCount) * 236),
    4: Math.round((distribution[4] / maxCount) * 236),
    3: Math.round((distribution[3] / maxCount) * 236),
    2: Math.round((distribution[2] / maxCount) * 236),
    1: Math.round((distribution[1] / maxCount) * 236),
  };

  // Animate bars on mount and when distribution changes
  useEffect(() => {
    const timer = setTimeout(() => {
      setAnimatedHeights(targetHeights);
    }, 100);
    return () => clearTimeout(timer);
  }, [targetHeights]);

  // Handle mouse move for tooltip positioning
  const handleMouseMove = (e) => {
    const rect = e.currentTarget.getBoundingClientRect();
    setMousePos({
      x: e.clientX - rect.left,
      y: e.clientY - rect.top
    });
  };

  return (
    <div className="relative w-full h-full">
      <svg
        viewBox="0 0 473 312"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        className="w-full h-auto"
        preserveAspectRatio="xMidYMid meet"
        onMouseMove={handleMouseMove}
      >
      <g clipPath="url(#clip0_552_9354)">
        
        {/* Grid lines */}
        <path d="M40.6621 14.7046L471.366 15.5459M40.6621 73.5974L471.366 74.4388M40.6621 140.904L471.366 141.745M40.6621 208.21L471.366 209.051M40.6621 275.516L471.366 276.357" stroke="#CACACA" strokeWidth="1.67697" strokeLinecap="square"/>
        
        {/* Y-axis labels */}
        <path d="M6.12723 17.7061V5.85301H7.36767V17.7061H6.12723ZM3.62913 6.97284V5.85301H7.19538V6.97284H3.62913ZM14.3432 17.8783C13.4703 17.8783 12.6721 17.6314 11.9485 17.1375C11.2249 16.6322 10.6449 15.9201 10.2084 15.0012C9.78348 14.0824 9.571 13.0027 9.571 11.7623C9.571 10.5104 9.78348 9.43649 10.2084 8.54062C10.6334 7.63326 11.2019 6.93265 11.914 6.43877C12.6376 5.93341 13.4359 5.68072 14.3088 5.68072C15.1932 5.68072 15.9914 5.92766 16.7035 6.42154C17.4271 6.91542 18.0014 7.62178 18.4263 8.54062C18.8513 9.44797 19.0638 10.5276 19.0638 11.7795C19.0638 13.02 18.8513 14.0996 18.4263 15.0184C18.0014 15.9373 17.4328 16.6436 16.7207 17.1375C16.0086 17.6314 15.2161 17.8783 14.3432 17.8783ZM14.3088 16.6896C14.9864 16.6896 15.5837 16.5001 16.1005 16.1211C16.6288 15.7305 17.0423 15.1735 17.3409 14.4499C17.6396 13.7148 17.7889 12.819 17.7889 11.7623C17.7889 10.7171 17.6396 9.83274 17.3409 9.10915C17.0423 8.37408 16.6288 7.81703 16.1005 7.43801C15.5837 7.05899 14.9864 6.86948 14.3088 6.86948C13.6426 6.86948 13.0454 7.05899 12.517 7.43801C12.0002 7.81703 11.5924 8.36833 11.2938 9.09192C10.9952 9.81551 10.8459 10.7056 10.8459 11.7623C10.8459 12.819 10.9952 13.7148 11.2938 14.4499C11.5924 15.1735 12.0002 15.7305 12.517 16.1211C13.0454 16.5001 13.6426 16.6896 14.3088 16.6896ZM25.4938 17.8783C24.6209 17.8783 23.8227 17.6314 23.0991 17.1375C22.3755 16.6322 21.7955 15.9201 21.359 15.0012C20.9341 14.0824 20.7216 13.0027 20.7216 11.7623C20.7216 10.5104 20.9341 9.43649 21.359 8.54062C21.784 7.63326 22.3525 6.93265 23.0646 6.43877C23.7882 5.93341 24.5865 5.68072 25.4594 5.68072C26.3437 5.68072 27.142 5.92766 27.8541 6.42154C28.5777 6.91542 29.152 7.62178 29.5769 8.54062C30.0019 9.44797 30.2144 10.5276 30.2144 11.7795C30.2144 13.02 30.0019 14.0996 29.5769 15.0184C29.152 15.9373 28.5834 16.6436 27.8713 17.1375C27.1592 17.6314 26.3667 17.8783 25.4938 17.8783ZM25.4594 16.6896C26.137 16.6896 26.7343 16.5001 27.2511 16.1211C27.7794 15.7305 28.1929 15.1735 28.4915 14.4499C28.7902 13.7148 28.9395 12.819 28.9395 11.7623C28.9395 10.7171 28.7902 9.83274 28.4915 9.10915C28.1929 8.37408 27.7794 7.81703 27.2511 7.43801C26.7343 7.05899 26.137 6.86948 25.4594 6.86948C24.7932 6.86948 24.196 7.05899 23.6676 7.43801C23.1508 7.81703 22.743 8.36833 22.4444 9.09192C22.1458 9.81551 21.9965 10.7056 21.9965 11.7623C21.9965 12.819 22.1458 13.7148 22.4444 14.4499C22.743 15.1735 23.1508 15.7305 23.6676 16.1211C24.196 16.5001 24.7932 16.6896 25.4594 16.6896Z" fill="#1E1E1E"/>
        <path d="M13.6911 78.0049L18.2393 66.8583L19.4625 66.9444L15.0004 78.0049H13.6911ZM11.6409 67.2717V66.1519H19.4625V66.9444L18.9112 67.2717H11.6409ZM25.3328 78.1772C24.4599 78.1772 23.6617 77.9302 22.9381 77.4364C22.2145 76.931 21.6345 76.2189 21.1981 75.3001C20.7731 74.3812 20.5606 73.3016 20.5606 72.0612C20.5606 70.8093 20.7731 69.7354 21.1981 68.8395C21.623 67.9322 22.1916 67.2315 22.9037 66.7377C23.6273 66.2323 24.4255 65.9796 25.2984 65.9796C26.1828 65.9796 26.981 66.2266 27.6931 66.7204C28.4167 67.2143 28.9909 67.9207 29.4159 68.8395C29.8409 69.7469 30.0534 70.8265 30.0534 72.0784C30.0534 73.3188 29.8409 74.3985 29.4159 75.3173C28.9909 76.2361 28.4224 76.9425 27.7103 77.4364C26.9982 77.9302 26.2057 78.1772 25.3328 78.1772ZM25.2984 76.9884C25.976 76.9884 26.5733 76.7989 27.0901 76.4199C27.6184 76.0294 28.0319 75.4723 28.3305 74.7488C28.6292 74.0137 28.7785 73.1178 28.7785 72.0612C28.7785 71.016 28.6292 70.1316 28.3305 69.408C28.0319 68.673 27.6184 68.1159 27.0901 67.7369C26.5733 67.3579 25.976 67.1684 25.2984 67.1684C24.6322 67.1684 24.035 67.3579 23.5067 67.7369C22.9898 68.1159 22.5821 68.6672 22.2835 69.3908C21.9848 70.1144 21.8355 71.0045 21.8355 72.0612C21.8355 73.1178 21.9848 74.0137 22.2835 74.7488C22.5821 75.4723 22.9898 76.0294 23.5067 76.4199C24.035 76.7989 24.6322 76.9884 25.2984 76.9884Z" fill="#1E1E1E"/>
        <path d="M14.8222 144.936C14.0412 144.936 13.3406 144.787 12.7204 144.488C12.1001 144.189 11.5776 143.759 11.1526 143.196L11.9968 142.352C12.2839 142.788 12.6687 143.133 13.1511 143.385C13.6449 143.627 14.1962 143.747 14.805 143.747C15.3792 143.747 15.8846 143.638 16.321 143.42C16.7575 143.19 17.0963 142.874 17.3375 142.472C17.5902 142.059 17.7165 141.576 17.7165 141.025C17.7165 140.462 17.5959 139.98 17.3547 139.578C17.1135 139.165 16.7862 138.849 16.3727 138.63C15.9592 138.412 15.4941 138.303 14.9772 138.303C14.4834 138.303 14.0297 138.372 13.6162 138.51C13.2142 138.636 12.8467 138.843 12.5136 139.13L12.4792 138.303C12.6859 138.073 12.9213 137.884 13.1855 137.735C13.4497 137.585 13.7426 137.47 14.0642 137.39C14.3972 137.31 14.7648 137.269 15.1668 137.269C15.9592 137.269 16.6426 137.442 17.2169 137.786C17.7912 138.119 18.2276 138.573 18.5262 139.147C18.8363 139.722 18.9914 140.37 18.9914 141.094C18.9914 141.841 18.8134 142.501 18.4573 143.075C18.1013 143.65 17.6074 144.103 16.9757 144.436C16.3555 144.769 15.6377 144.936 14.8222 144.936ZM12.5136 139.13L11.8417 138.441L12.3586 132.911H13.5128L12.9443 138.562L12.5136 139.13ZM12.6687 134.031L12.3586 132.911H18.4573V134.031H12.6687ZM25.3328 144.936C24.4599 144.936 23.6617 144.689 22.9381 144.195C22.2145 143.69 21.6345 142.978 21.1981 142.059C20.7731 141.14 20.5606 140.06 20.5606 138.82C20.5606 137.568 20.7731 136.494 21.1981 135.598C21.623 134.691 22.1916 133.99 22.9037 133.496C23.6273 132.991 24.4255 132.738 25.2984 132.738C26.1828 132.738 26.981 132.985 27.6931 133.479C28.4167 133.973 28.9909 134.679 29.4159 135.598C29.8409 136.506 30.0533 137.585 30.0533 138.837C30.0533 140.078 29.8409 141.157 29.4159 142.076C28.9909 142.995 28.4224 143.701 27.7103 144.195C26.9982 144.689 26.2057 144.936 25.3328 144.936ZM25.2984 143.747C25.976 143.747 26.5733 143.558 27.0901 143.179C27.6184 142.788 28.0319 142.231 28.3305 141.508C28.6292 140.772 28.7785 139.877 28.7785 138.82C28.7785 137.775 28.6292 136.89 28.3305 136.167C28.0319 135.432 27.6184 134.875 27.0901 134.496C26.5733 134.117 25.976 133.927 25.2984 133.927C24.6322 133.927 24.035 134.117 23.5067 134.496C22.9898 134.875 22.5821 135.426 22.2835 136.15C21.9848 136.873 21.8355 137.763 21.8355 138.82C21.8355 139.877 21.9848 140.772 22.2835 141.508C22.5821 142.231 22.9898 142.788 23.5067 143.179C24.035 143.558 24.6322 143.747 25.2984 143.747Z" fill="#1E1E1E"/>
        <path d="M11.1706 208.594L15.5638 204.011C16.0692 203.471 16.4597 203.018 16.7353 202.65C17.0225 202.283 17.2177 201.95 17.3211 201.651C17.4359 201.341 17.4934 201.019 17.4934 200.686C17.4934 200.009 17.2809 199.48 16.8559 199.101C16.431 198.711 15.8682 198.515 15.1676 198.515C14.5244 198.515 13.9616 198.67 13.4792 198.981C12.9968 199.279 12.5661 199.733 12.1871 200.342L11.3085 199.566C11.7679 198.843 12.3192 198.291 12.9624 197.912C13.6055 197.533 14.3521 197.344 15.202 197.344C15.9141 197.344 16.5343 197.482 17.0627 197.757C17.6025 198.033 18.0159 198.424 18.3031 198.929C18.6017 199.434 18.751 200.026 18.751 200.703C18.751 201.174 18.6878 201.605 18.5615 201.995C18.4352 202.375 18.2112 202.777 17.8896 203.201C17.5795 203.615 17.1373 204.12 16.563 204.718L12.8418 208.542L11.1706 208.594ZM11.1706 209.369V208.594L12.2043 208.232H19.0439V209.369H11.1706ZM25.3328 209.541C24.4599 209.541 23.6617 209.294 22.9381 208.801C22.2145 208.295 21.6345 207.583 21.1981 206.664C20.7731 205.745 20.5606 204.666 20.5606 203.425C20.5606 202.174 20.7731 201.1 21.1981 200.204C21.623 199.296 22.1916 198.596 22.9037 198.102C23.6273 197.597 24.4255 197.344 25.2984 197.344C26.1828 197.344 26.981 197.591 27.6931 198.085C28.4167 198.579 28.9909 199.285 29.4159 200.204C29.8409 201.111 30.0534 202.191 30.0534 203.443C30.0534 204.683 29.8409 205.763 29.4159 206.682C28.9909 207.6 28.4224 208.307 27.7103 208.801C26.9982 209.294 26.2057 209.541 25.3328 209.541ZM25.2984 208.353C25.976 208.353 26.5733 208.163 27.0901 207.784C27.6184 207.394 28.0319 206.837 28.3305 206.113C28.6292 205.378 28.7785 204.482 28.7785 203.425C28.7785 202.38 28.6292 201.496 28.3305 200.772C28.0319 200.037 27.6184 199.48 27.0901 199.101C26.5733 198.722 25.976 198.533 25.2984 198.533C24.6322 198.533 24.035 198.722 23.5067 199.101C22.9898 199.48 22.5821 200.031 22.2835 200.755C21.9848 201.479 21.8355 202.369 21.8355 203.425C21.8355 204.482 21.9848 205.378 22.2835 206.113C22.5821 206.837 22.9898 207.394 23.5067 207.784C24.035 208.163 24.6322 208.353 25.2984 208.353Z" fill="#1E1E1E"/>
        <path d="M25.3322 277.377C24.4593 277.377 23.6611 277.13 22.9375 276.637C22.2139 276.131 21.6339 275.419 21.1975 274.5C20.7725 273.581 20.56 272.502 20.56 271.261C20.56 270.009 20.7725 268.936 21.1975 268.04C21.6224 267.132 22.191 266.432 22.9031 265.938C23.6267 265.433 24.4249 265.18 25.2978 265.18C26.1822 265.18 26.9804 265.427 27.6925 265.921C28.4161 266.415 28.9903 267.121 29.4153 268.04C29.8403 268.947 30.0528 270.027 30.0528 271.279C30.0528 272.519 29.8403 273.599 29.4153 274.517C28.9903 275.436 28.4218 276.143 27.7097 276.637C26.9976 277.13 26.2051 277.377 25.3322 277.377ZM25.2978 276.189C25.9754 276.189 26.5727 275.999 27.0895 275.62C27.6178 275.23 28.0313 274.673 28.3299 273.949C28.6286 273.214 28.7779 272.318 28.7779 271.261C28.7779 270.216 28.6286 269.332 28.3299 268.608C28.0313 267.873 27.6178 267.316 27.0895 266.937C26.5727 266.558 25.9754 266.369 25.2978 266.369C24.6316 266.369 24.0344 266.558 23.5061 266.937C22.9892 267.316 22.5815 267.867 22.2829 268.591C21.9842 269.315 21.8349 270.205 21.8349 271.261C21.8349 272.318 21.9842 273.214 22.2829 273.949C22.5815 274.673 22.9892 275.23 23.5061 275.62C24.0344 275.999 24.6316 276.189 25.2978 276.189Z" fill="#1E1E1E"/>
        
        {/* Stars and labels for X-axis */}
        <path d="M420.639 305.83C421.365 306.271 422.264 305.621 422.073 304.793L421.214 301.06C421.134 300.715 421.252 300.353 421.519 300.12L424.406 297.605C425.045 297.048 424.703 295.997 423.859 295.923L420.048 295.591C419.693 295.56 419.384 295.335 419.246 295.006L417.774 291.507C417.444 290.722 416.332 290.722 416.002 291.507L414.53 295.006C414.392 295.335 414.083 295.56 413.728 295.591L409.917 295.923C409.073 295.997 408.731 297.048 409.37 297.605L412.257 300.12C412.524 300.353 412.642 300.715 412.562 301.06L411.703 304.793C411.512 305.621 412.411 306.271 413.137 305.83L416.39 303.859C416.696 303.673 417.08 303.673 417.386 303.859L420.639 305.83Z" fill="#796BF5"/>
        <path d="M394.991 306.249C394.078 306.249 393.26 306.075 392.536 305.726C391.811 305.377 391.201 304.874 390.704 304.217L391.69 303.231C392.026 303.74 392.475 304.143 393.039 304.438C393.616 304.72 394.26 304.861 394.971 304.861C395.641 304.861 396.232 304.733 396.741 304.478C397.251 304.21 397.647 303.841 397.929 303.371C398.224 302.888 398.371 302.325 398.371 301.681C398.371 301.024 398.231 300.46 397.949 299.991C397.667 299.508 397.285 299.139 396.802 298.884C396.319 298.629 395.775 298.501 395.172 298.501C394.595 298.501 394.065 298.582 393.582 298.743C393.112 298.891 392.683 299.132 392.294 299.467L392.254 298.501C392.495 298.233 392.77 298.012 393.079 297.837C393.387 297.663 393.73 297.529 394.105 297.435C394.494 297.341 394.924 297.294 395.393 297.294C396.319 297.294 397.117 297.495 397.788 297.898C398.459 298.287 398.968 298.817 399.317 299.488C399.679 300.158 399.861 300.916 399.861 301.762C399.861 302.634 399.653 303.405 399.237 304.076C398.821 304.747 398.244 305.276 397.506 305.666C396.782 306.055 395.943 306.249 394.991 306.249ZM392.294 299.467L391.509 298.662L392.113 292.203H393.461L392.797 298.803L392.294 299.467ZM392.475 293.511L392.113 292.203H399.237V293.511H392.475Z" fill="#1E1E1E"/>
        <path d="M341.656 305.832C342.383 306.272 343.281 305.622 343.091 304.795L342.231 301.062C342.152 300.716 342.269 300.355 342.537 300.122L345.424 297.607C346.063 297.05 345.721 295.998 344.876 295.925L341.066 295.592C340.71 295.561 340.402 295.336 340.263 295.008L338.791 291.508C338.461 290.724 337.35 290.724 337.02 291.508L335.548 295.008C335.41 295.336 335.101 295.561 334.746 295.592L330.935 295.925C330.091 295.998 329.748 297.05 330.387 297.607L333.274 300.122C333.542 300.355 333.659 300.716 333.58 301.062L332.72 304.795C332.53 305.622 333.428 306.272 334.155 305.832L337.407 303.86C337.714 303.675 338.098 303.675 338.404 303.86L341.656 305.832Z" fill="#796BF5"/>
        <path d="M313.765 301.46L318.936 292.203H320.587L315.334 301.46H313.765ZM313.765 302.385V301.46L314.389 301.057H324.249V302.385H313.765ZM320.748 306.048V296.811H322.197V306.048H320.748Z" fill="#1E1E1E"/>
        <path d="M269.285 305.83C270.012 306.271 270.91 305.621 270.72 304.793L269.86 301.06C269.781 300.715 269.898 300.353 270.166 300.12L273.053 297.605C273.692 297.048 273.35 295.997 272.505 295.923L268.694 295.591C268.339 295.56 268.03 295.335 267.892 295.006L266.42 291.507C266.09 290.722 264.979 290.722 264.649 291.507L263.177 295.006C263.038 295.335 262.73 295.56 262.374 295.591L258.564 295.923C257.719 295.997 257.377 297.048 258.016 297.605L260.903 300.12C261.171 300.353 261.288 300.715 261.209 301.06L260.349 304.793C260.159 305.621 261.057 306.271 261.784 305.83L265.036 303.859C265.343 303.673 265.726 303.673 266.033 303.859L269.285 305.83Z" fill="#796BF5"/>
        <path d="M246.991 306.249C246.105 306.249 245.294 306.075 244.556 305.726C243.831 305.377 243.221 304.874 242.724 304.217L243.711 303.231C244.046 303.74 244.502 304.143 245.079 304.438C245.656 304.72 246.286 304.861 246.971 304.861C247.641 304.861 248.218 304.733 248.701 304.478C249.198 304.223 249.58 303.868 249.848 303.412C250.13 302.942 250.271 302.399 250.271 301.782C250.271 301.151 250.13 300.608 249.848 300.152C249.58 299.695 249.191 299.34 248.681 299.085C248.185 298.83 247.588 298.703 246.89 298.703C246.662 298.703 246.427 298.716 246.186 298.743C245.958 298.77 245.73 298.817 245.502 298.884L246.065 298.059C246.293 297.938 246.541 297.844 246.81 297.777C247.078 297.71 247.373 297.676 247.695 297.676C248.46 297.676 249.151 297.858 249.768 298.22C250.385 298.569 250.868 299.058 251.217 299.689C251.579 300.306 251.76 301.024 251.76 301.842C251.76 302.714 251.559 303.479 251.156 304.136C250.754 304.793 250.19 305.31 249.466 305.686C248.755 306.061 247.93 306.249 246.991 306.249ZM245.502 298.884V297.978L249.888 293.048L251.599 293.108L247.132 298.099L245.502 298.884ZM243.328 293.511V292.203H251.599V293.108L250.331 293.511H243.328Z" fill="#1E1E1E"/>
        <path d="M198.283 305.83C199.01 306.271 199.908 305.621 199.718 304.793L198.858 301.06C198.779 300.715 198.896 300.353 199.164 300.12L202.051 297.605C202.69 297.048 202.348 295.997 201.503 295.923L197.693 295.591C197.337 295.56 197.029 295.335 196.89 295.006L195.418 291.507C195.088 290.722 193.977 290.722 193.647 291.507L192.175 295.006C192.037 295.335 191.728 295.56 191.373 295.591L187.562 295.923C186.717 295.997 186.375 297.048 187.014 297.605L189.901 300.12C190.169 300.353 190.286 300.715 190.207 301.06L189.347 304.793C189.157 305.621 190.055 306.271 190.782 305.83L194.034 303.859C194.341 303.673 194.724 303.673 195.031 303.859L198.283 305.83Z" fill="#796BF5"/>
        <path d="M171.765 305.142L176.896 299.789C177.487 299.159 177.943 298.629 178.265 298.2C178.6 297.77 178.828 297.381 178.949 297.032C179.083 296.67 179.15 296.295 179.15 295.906C179.15 295.114 178.902 294.497 178.405 294.054C177.909 293.598 177.252 293.37 176.433 293.37C175.682 293.37 175.025 293.551 174.461 293.913C173.898 294.262 173.395 294.792 172.952 295.503L171.926 294.598C172.462 293.752 173.106 293.108 173.858 292.666C174.609 292.223 175.481 292.002 176.474 292.002C177.305 292.002 178.03 292.163 178.647 292.485C179.278 292.807 179.76 293.263 180.096 293.853C180.445 294.443 180.619 295.134 180.619 295.926C180.619 296.476 180.545 296.979 180.398 297.435C180.25 297.878 179.989 298.347 179.613 298.844C179.251 299.327 178.734 299.917 178.063 300.614L173.717 305.082L171.765 305.142ZM171.765 306.048V305.142L172.972 304.72H180.961V306.048H171.765Z" fill="#1E1E1E"/>
        <path d="M127.207 305.83C127.934 306.271 128.832 305.621 128.642 304.793L127.782 301.06C127.703 300.715 127.82 300.353 128.088 300.12L130.975 297.605C131.614 297.048 131.271 295.997 130.427 295.923L126.616 295.591C126.261 295.56 125.952 295.335 125.814 295.006L124.342 291.507C124.012 290.722 122.901 290.722 122.571 291.507L121.099 295.006C120.96 295.335 120.652 295.56 120.296 295.591L116.486 295.923C115.641 295.997 115.299 297.048 115.938 297.605L118.825 300.12C119.093 300.353 119.21 300.715 119.13 301.06L118.271 304.793C118.081 305.621 118.979 306.271 119.706 305.83L122.958 303.859C123.264 303.673 123.648 303.673 123.954 303.859L127.207 305.83Z" fill="#796BF5"/>
        <path d="M102.642 306.048V292.203H104.091V306.048H102.642ZM99.7245 293.511V292.203H103.89V293.511H99.7245Z" fill="#1E1E1E"/>
        
        {/* Dynamic bars */}
        {[1, 2, 3, 4, 5].map((star) => {
          const x = star === 1 ? 93 : star === 2 ? 166 : star === 3 ? 240 : star === 4 ? 313 : 387;
          const height = animatedHeights[star];
          const minHeight = 45; // Increased minimum height to maintain bar shape
          const displayHeight = height > 0 ? Math.max(height, minHeight) : 0;
          const isHovered = hoveredStar === star;
          const percentage = percentages[star];

          return (
            <g key={star}>
              <rect
                x={x}
                y={276 - displayHeight}
                width="41"
                height={displayHeight}
                rx="20.5"
                fill="#796BF5"
                fillOpacity={hoveredStar && hoveredStar !== star ? 0.5 : 1}
                style={{
                  transition: "all 0.5s ease-out",
                  transitionDelay: `${star * 0.02}s`, // Staggered animation
                  cursor: 'pointer'
                }}
                onMouseEnter={() => setHoveredStar(star)}
                onMouseLeave={() => setHoveredStar(null)}
              />
            </g>
          );
        })}
      </g>
      <defs>
        <clipPath id="clip0_552_9354">
          <rect width="473" height="312" rx="1.07676"/>
        </clipPath>
      </defs>
    </svg>
    
    {/* Tooltip */}
    {hoveredStar && (
      <div
        className="absolute z-10 px-3 py-2 text-sm text-white bg-gray-900 rounded-lg shadow-lg pointer-events-none"
        style={{
          left: `${mousePos.x}px`,
          top: `${mousePos.y - 40}px`,
          transform: 'translateX(-50%)'
        }}
      >
        <div className="font-medium">{hoveredStar} {hoveredStar === 1 ? 'star' : 'stars'}</div>
        <div className="text-gray-300">{distribution[hoveredStar]} reviews ({percentages[hoveredStar]}%)</div>
        <div className="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full">
          <div className="w-0 h-0 border-l-4 border-l-transparent border-r-4 border-r-transparent border-t-4 border-t-gray-900"></div>
        </div>
      </div>
    )}
    </div>
  );
}